//////////////////////////////////////////////////////////////////////////////////////////////
// DO NOT MODIFY THIS FILE                                                                  //
// This file is automatically generated by ZenStack CLI and should not be manually updated. //
//////////////////////////////////////////////////////////////////////////////////////////////

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

/// Enum for users.role
enum UserRole {
  ADMIN
  LECTURER
  STUDENT
}

/// Enum for exams.status
enum ExamStatus {
  PENDING
  ACTIVE
  INACTIVE
}

/// Enum for questions.question_type
enum QuestionType {
  SINGLE_CHOICE
  MULTIPLE_CHOICE
  ESSAY
}

/// Enum for questions.question_format
enum QuestionFormat {
  KNOWLEDGE
  UNDERSTANDING
  APPLYING
  ADVANCED
}

/// Enum for submissions.rating
enum Rating {
  EXCELLENT
  GOOD
  AVERAGE
  POOR
}

model User {
  id            String       @id() @default(dbgenerated("gen_random_uuid()")) @db.Uuid()
  created_at    DateTime     @default(now())
  updated_at    DateTime     @updatedAt()
  full_name     String
  email         String       @unique()
  password      String
  role          UserRole     @default(STUDENT)
  auth_provider String       @default("local")
  provider_id   String?
  exams         Exam[]
  questions     Question[]
  submissions   Submission[]

  @@map("users")
}

model Exam {
  id              String          @id() @default(dbgenerated("gen_random_uuid()")) @db.Uuid()
  created_at      DateTime        @default(now())
  updated_at      DateTime        @updatedAt()
  lecturer_id     String          @db.Uuid()
  topic           String
  title           String
  exam_start_time DateTime
  exam_end_time   DateTime
  duration        Int
  practice        Boolean         @default(false)
  status          ExamStatus      @default(PENDING)
  submissions     Submission[]
  questions       ExamQuestions[]
  lecturer        User            @relation(fields: [lecturer_id], references: [id], onDelete: Cascade)

  @@map("exams")
}

model Submission {
  id          String                @id() @default(dbgenerated("gen_random_uuid()")) @db.Uuid()
  created_at  DateTime              @default(now())
  updated_at  DateTime              @updatedAt()
  exam_id     String                @db.Uuid()
  student_id  String                @db.Uuid()
  total_score Decimal?
  rating      Rating?
  start_time  DateTime
  end_time    DateTime
  questions   SubmissionQuestions[]
  exam        Exam                  @relation(fields: [exam_id], references: [id], onDelete: Cascade)
  student     User                  @relation(fields: [student_id], references: [id], onDelete: Cascade)

  @@map("submissions")
}

model Question {
  id              String                @id() @default(dbgenerated("gen_random_uuid()")) @db.Uuid()
  created_at      DateTime              @default(now())
  updated_at      DateTime              @updatedAt()
  lecturer_id     String                @db.Uuid()
  question_text   String
  topic           String
  option          String?
  correct_answer  String?
  image_url       String?
  question_type   QuestionType
  question_format QuestionFormat
  submissions     SubmissionQuestions[]
  exams           ExamQuestions[]
  lecturer        User                  @relation(fields: [lecturer_id], references: [id], onDelete: Cascade)

  @@map("questions")
}

model ExamQuestions {
  id          String   @id() @default(dbgenerated("gen_random_uuid()")) @db.Uuid()
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt()
  exam_id     String   @db.Uuid()
  question_id String   @db.Uuid()
  exam        Exam     @relation(fields: [exam_id], references: [id], onDelete: Cascade)
  question    Question @relation(fields: [question_id], references: [id], onDelete: Cascade)

  @@unique([exam_id, question_id])
  @@map("exam_questions")
}

model SubmissionQuestions {
  id            String     @id() @default(dbgenerated("gen_random_uuid()")) @db.Uuid()
  created_at    DateTime   @default(now())
  updated_at    DateTime   @updatedAt()
  submission_id String     @db.Uuid()
  question_id   String     @db.Uuid()
  options       String?
  answer        String?
  score         Decimal?
  is_correct    Boolean    @default(false)
  submission    Submission @relation(fields: [submission_id], references: [id], onDelete: Cascade)
  question      Question   @relation(fields: [question_id], references: [id], onDelete: Cascade)

  @@unique([submission_id, question_id])
  @@map("submission_questions")
}
